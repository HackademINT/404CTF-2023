#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <stdbool.h>

void canary(void)
{
    puts("Je vous suis infiniment reconnaissant d'avoir retrouvé mon canari.");
    FILE *flag = fopen("flag.txt", "r");
    char buf[72];
    fgets(buf, sizeof(buf), flag);
    puts(buf);
    fclose(flag);
    flag = NULL;
}

void choices(void)
{
    char buf[64];
    int sel = 0;
    bool doneFrancis = false;
    bool doneThink = false;
    while (1)
    {
        puts("Que faites-vous ?");
        puts("\n1 : Aller voir Francis");
        puts("2 : Réfléchir à un moyen de capturer le canari");
        puts("3 : Vaquer à vos occupations");

        printf(">>> ");
        fflush(stdout);
        if (1 != scanf("%d", &sel))
        {
            exit(EXIT_SUCCESS);
        }
        if (sel < 1 || sel > 6)
        {
            continue;
        }
        switch (sel)
        {
        case 1:
            if (doneFrancis)
            {
                puts("\n[Francis] : Je crains que je ne puisse plus compter sur vous pour m'aider, malheureusement.\n");
            }
            else
            {
                puts("\n[Francis] : Avez-vous trouvé un moyen de capturer mon canari ? J'espère que j'ai eu raison de compter sur vous.");
                printf("[Vous] : ");
                fgets(buf, sizeof(buf), stdin);
                gets(buf);
                puts("[Francis] : Je vous laisse mettre votre plan à éxécution.\n");
                doneFrancis = true;
            }
            break;
        case 2:
            if (doneThink)
            {
                puts("\n(Alors que vous vous apprétiez à plonger dans vos pensées, vous réalisez que vous n'avez pas de temps à perdre.)\n");
            }
            else
            {
                fgets(buf, 64, stdin);
                fgets(buf, 64, stdin);
                printf("[Vous] : ");
                printf(buf);
                puts("");
                doneThink = true;
            }
            break;
        case 3:
            return;
        default:
            break;
        }
    }
}

int main(int argc, char **argv)
{
    setvbuf(stdout, NULL, _IONBF, 0);
    choices();
    return EXIT_SUCCESS;
}